<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta property="og:title" content="Debotz" />
    <meta name="keywords" content="Aplikasi, Adobe, Software" />
    <meta
      property="og:description"
      content="Debotz adalah website yang menyediakan berbagai software berkualitas untuk memenuhi kebutuhan teknologi Anda. Dengan beragam pilihan aplikasi dan tools, Debotz berfokus pada memberikan solusi praktis untuk bisnis, pengembangan, dan penggunaan sehari-hari."
    />
    <meta
      property="og:image"
      content="https://res.cloudinary.com/dwpnsfghy/image/upload/v1727440966/fniygrbsecuvt4bbjir0.png"
    />
    <meta property="og:url" content="#" />
    <meta property="og:site_name" content="Debotz" />
    <title>Debotz - Login-Succces</title>
    <link
      rel="icon"
      href="https://res.cloudinary.com/dwpnsfghy/image/upload/v1727440966/fniygrbsecuvt4bbjir0.png"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="../css/Login/Profile.css" />
  </head>
  <body>
    <div class="profile-container">
      <img
        id="profile-pic"
        src="https://res.cloudinary.com/dwpnsfghy/image/upload/v1727440966/fniygrbsecuvt4bbjir0.png"
        alt="Profile Picture"
      />
      <h1>Login Successful</h1>
      <p id="welcome-message">Welcome, <span id="user-name"></span>!</p>
      <p>Email: <span id="user-email"></span></p>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <script>
      // Function to get URL parameters
      function getUrlParameter(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
        var results = regex.exec(location.search);
        return results === null
          ? ""
          : decodeURIComponent(results[1].replace(/\+/g, " "));
      }

      // Function to handle Google Sign-In data
      function handleCredentialResponse(response) {
        const responsePayload = decodeJwtResponse(response.credential);
        document.getElementById("user-name").textContent = responsePayload.name;
        document.getElementById("user-email").textContent =
          responsePayload.email;
      }

      // Function to decode JWT token
      function decodeJwtResponse(token) {
        var base64Url = token.split(".")[1];
        var base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
        var jsonPayload = decodeURIComponent(
          atob(base64)
            .split("")
            .map(function (c) {
              return "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2);
            })
            .join("")
        );

        return JSON.parse(jsonPayload);
      }

      // Check if user data is in URL parameters (for regular login)
      var username = getUrlParameter("username");
      var email = getUrlParameter("email");

      if (username && email) {
        document.getElementById("user-name").textContent = username;
        document.getElementById("user-email").textContent = email;
      } else {
        // If not in URL, check for Google Sign-In data in localStorage
        var googleUser = localStorage.getItem("googleUser");
        if (googleUser) {
          var userData = JSON.parse(googleUser);
          document.getElementById("user-name").textContent = userData.name;
          document.getElementById("user-email").textContent = userData.email;
          document
            .getElementById("profile-pic")
            .setAttribute("src", userData.picture); // Set profile picture
        } else {
          // If no data found, redirect to login page
          window.location.href = "/Login.html";
        }
      }

      function logout() {
        // Clear any stored user data
        localStorage.removeItem("googleUser");
        // Redirect to login page
        window.location.href = "/Login.html";
      }
    </script>
  </body>
</html>
